<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:cache="http://www.springframework.org/schema/cache"
       xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-3.1.xsd
           http://www.springframework.org/schema/cache
           http://www.springframework.org/schema/cache/spring-cache-3.1.xsd">

    <cache:annotation-driven cache-manager="memcacheManager"/>

    <bean name="memcacheManager" class="com.google.code.ssm.spring.SSMCacheManager">
        <property name="caches">
            <set>
                <bean class="com.google.code.ssm.spring.SSMCache">
                    <constructor-arg name="cache" index="0" ref="adminCache"/>
                    <constructor-arg name="expiration" index="1" value="${cache.duration}"/>
                    <constructor-arg name="allowClear" index="2" value="true"/>
                </bean>
                <bean class="com.google.code.ssm.spring.SSMCache">
                    <constructor-arg name="cache" index="0" ref="defaultCache"/>
                    <constructor-arg name="expiration" index="1" value="${cache.duration}"/>
                    <constructor-arg name="allowClear" index="2" value="true"/>
                </bean>
				<bean class="com.google.code.ssm.spring.SSMCache">
                    <constructor-arg name="cache" index="0" ref="configCache"/>
                    <constructor-arg name="expiration" index="1" value="${cache.duration}"/>
                    <constructor-arg name="allowClear" index="2" value="true"/>
                </bean>
                <bean class="com.google.code.ssm.spring.SSMCache">
                    <constructor-arg name="cache" index="0" ref="userCache"/>
                    <constructor-arg name="expiration" index="1" value="${cache.duration}"/>
                    <constructor-arg name="allowClear" index="2" value="true"/>
                </bean>
            </set>
        </property>

    </bean>
    
	<!-- config -->
    <bean name="awsAddressProvider" class="com.google.code.ssm.config.DefaultAddressProvider">
        <property name="address" value="${server.url}"/>
    </bean>
    <bean name="cacheConfiguration" class="com.google.code.ssm.providers.CacheConfiguration">
        <property name="consistentHashing" value="true"/>
    </bean>
    <bean name="cacheClientFactory" class="com.google.code.ssm.providers.xmemcached.MemcacheClientFactoryImpl"/>

	<!-- cache factory -->
	<bean name="adminCache" class="com.google.code.ssm.CacheFactory">
        <property name="cacheName" value="adminCache"/>
        <property name="cacheClientFactory" ref="cacheClientFactory"/>
        <property name="addressProvider" ref="awsAddressProvider"/>
        <property name="configuration" ref="cacheConfiguration"/>
    </bean>
	<bean name="defaultCache" class="com.google.code.ssm.CacheFactory">
        <property name="cacheName" value="defaultCache"/>
        <property name="cacheClientFactory" ref="cacheClientFactory"/>
        <property name="addressProvider" ref="awsAddressProvider"/>
        <property name="configuration" ref="cacheConfiguration"/>
    </bean>
	<bean name="configCache" class="com.google.code.ssm.CacheFactory">
        <property name="cacheName" value="configCache"/>
        <property name="cacheClientFactory" ref="cacheClientFactory"/>
        <property name="addressProvider" ref="awsAddressProvider"/>
        <property name="configuration" ref="cacheConfiguration"/>
    </bean>
    <bean name="userCache" class="com.google.code.ssm.CacheFactory">
        <property name="cacheName" value="userCache"/>
        <property name="cacheClientFactory" ref="cacheClientFactory"/>
        <property name="addressProvider" ref="awsAddressProvider"/>
        <property name="configuration" ref="cacheConfiguration"/>
    </bean>

</beans>
